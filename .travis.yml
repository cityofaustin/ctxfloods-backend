language: node_js
node_js:
- 8
addons:
  postgresql: 9.5
  apt:
    packages:
    - postgresql-9.5-postgis-2.3
services:
- postgresql
install: yarn;
before_script: yarn init-local-db;
script: yarn test;
deploy:
  provider: script
  script: yarn add global serverless@1.25.0; yarn; yarn deploy;
  on:
    all_branches: true
    condition: "$AWS_ACCESS_KEY_ID"
env:
  global:
  - secure: ZoqCUe+OplPc9Na48MAf2bNttXRfghgl8/Ebn9bQvrM4qx8LUWLyTIjAwjABpOAF8um26Dm1UDusbLEGoYlwuFUr5tuQ2+gpnVlo9BvUyrd/+Z69xNZBAOpXPEG51ByAAGUe6n/aCwBlOrtlnIWCUw3KJCk5UwyD1IjcIM8mIri7A/F03+BNmZWFdpJesO2LX/JEM3vcJtJzXTW0xvLeDA3+7SAehMuNVNQPHIq6k1ZmICZc/o88DolUTtNygAAfcB42/TiBRY2KhrMxQnSc0S3EKYLpOAyIhGKhKii/3Jwvjrx4RLfGI5r7UYHabgIPtHZciZcHa2Rc+z7zO8DKRuBYvjvPs7WN4lohm3AlqxjpYUHZqMpaqnuJBBU7YRbreEUDGcLcX3vtqT7MVwuc/97pGZkdwadllPM71/6QILcY7MadO4kDt4MU+UFjHo2nDAlcZZZRvdZLcCXcgHSUjaQfd3nmMdbtXQEkj4YUGrB2WhC87ddZ2rL/Aywigldskqx+zchovVH7xRbHrbAL/OYm6e99wJ71RQya+RLi7J3z5psqncuBvmxs+LPgIcXe7xvsKkbPM0UWYg6EXhO/sSt2TVJ1vmTSIJ+RHn285PUzzcgFYZZ3PoB62FNbr3OkcCYHDf54XC3kdScI6XFKod5EjaZJHYbebVB9opg8Tus=
  - secure: onFxRmb9dKAnWFPVahhXRFB/pcR3ZJCmyJEZHkjGucgYGy4MKHAxA1KdctnmKsOjNHRHyBeJXBfxYUqvto2EQy52uY+p6kIqlyj5mcX8UVdEpI+67/3pZPa+v+0/WIEjcKXSCoDysdTi4wJJ7iWhGmnXgN1jMUQdbaDuaIRHn/64EXT93ORvh/rkwghgslLbUycHixdF45QsfvHLccnaBDaLHOIyNXv22lIVuArfi11w5O+z9eeGarF+xn5yl8MNJSIMqIwrUncpag4cWxmwudspTLoxyCFTfvDTQw2JleK1cnGR6BoR6MYfsuupMD2f2y9qOSd6Vlq4klWYuSNpAycTI0jdQnjQa+BiW5HlxV4wS17MJG2/mX1x4Zif1cJy/U1G5q5tmM7PaTY/1L9lu/1OT/DwH7jhKwtRxw/1bkVialKXozNKR+d2tMo0I+emsarGcbebSmMa11lyOvh8l/cgFJlBkV1+4J0e8Cjb331/3mSUdTpPup0ljDMMWMiUByLaCXCwzOjJZivErrENma5i2/0XG9yOegnHrJxBwhyohJxOcU1y1rStziEbTIRZana20zcpQFYbxOsM7WtPbgeZzstXaGPH0WcTeg27WNjE3jECt8H4uNFzwLwpRKU39vql7M9ypyrDw0ZOPM7ZV6jJ+4wjljxIR1bkf+P2VQo=
  - secure: feXTavPYyhAV3tM1n52/57MTGlaI6iPg6yVJHrMo6Rv0xWK+dIOuydLlv5NrMBFQCDRBjTMyA4sZmGmdJXPTwoLZpFAF8FLkDaUL2F8Ogbsb0UpjpB6p9yv3BjUUO5qvgO9A3kXIHjRfHF8e300tyzfyzxMg2u0O0xc0M8/Qk1SrqZY38+sNYDYdx0noyi8ptEPiFJMgdfeQyTTPiMbtfYh9keewahGVFZVOodAWpwCEUQzcMUXqMOrRxer5v1r8Uf0EWWrPjgpN9rl79afKxGIG1nrqzXapr7k8BE9SEYNuh1BcO7b+eWg4OcjnXbExnQ/4qCehjd2ndz39jU6lFJWk0k9lErnuhntvRbwPsmxq4UjyJ137ttzNPNV7x8MsZuwWwQPnStv7MZKPKUcFPW88a7NEmSvkoVgkhkfHAslt6O7YBVdIt4RUA4vaCl08LvTFiCScvDVPgVLvHul1mrBPGcdAigt3IB8amDnwNOuG32N/Mi2frJr+iNM/0B/bOKmPbwNmosHz8QKGbIvxr03TY4JOVpq8CSr6FpxppRnpO8Fa6+dDmoRSeJgY37NOeGB6ZW7V9xoDiaB6P9BQPOB47KR7mqaxDX3wN6rDZhz++fonl5G0kva5wo0FDenfGxM7ZQXiBHCLdz+ojbMRYVDaZPW/5yOZ2OsQNwBWHOI=
  - secure: q7Ui6SCOzwh2COA0B4RmZ6iZ/QUL7D1Lb6Ij+JkDfPAGfX9qdTGBzu+G8XGiGWscuKlQcbRLMuYjlOPXp+pKWMDbn5puD6/PxMOA20MpVufsBlslASe19myGiY0UoejpxvDp6mJ8b9lem1LPuzTrVzcs4Cf8ksasGArrU80AL7nqyaQSwu6yn50D6psnug8PMZZcH2mhWSeFu1r+zyouVnW89DGWlwggiQ3IRYLBg84nfCpZHGE3pO6Y+Gpx3ncPtp+VTlyQa+ybQK1St0ZvCS99R5Wp+AGJwcvbJsDFOHmqWt9RmycTfuNnIRgrkal0vFpniYMiVKK72sNrWkcJkcD4VBvHgumb6PqSNaS8Cb6UeCqHE7DaJMtNHm3kuUrd+5VzxyIRsrY00wV1INZEhtND84y9MSXjop17JU1XXUfoLnv29S5phmwlptNA9rQzpafwran8g40v02GurRMNQ3McuFdSsTs6YoWx4iYuXPNNafYAP3Xe22NQtDcgkRk5/6SnEnV2w+DlLoKFsRh+idpyo0+i836rBIWhhi+EBjpbQwmjjEWwbSBhAozqNXQ58xIZ5fw9aKBSxs+mPy2EwAr81pORTU4kL0iWW4dBj4YT1J+6f2I3ozEvedAsfFbxPmA9LDTCFMR1j5tnTfa4QwWTmDru+/c2vXQm5p2ed2Q=
  - secure: YNzXmmP2XQ6gZMvNZ4n5C2X+rWk1fKV/53h1jOiuBtqoDtA0/fg0qWwVXSUCzMiK7K2JxFb2LHtRr+5kYVa+/gjUAmZEVUJNAyw/t0Pi6wBOXaRwFj126B9WihNT6QXesvrv2277JAs12ypLgCb0z82VJsEhmvV3j0w9V48Bi2SMEVbrzTj+CUQqqsaic92JxibX21uFDMn8MPjTCs1ffvqroujAQ9MH7CUs/0mPHa4Z2C7fZb+XQfk3vRaRXpOlHwCCrdtkzAZDdvy46B7djQBNaxjqHwG2TE29me9hgrrEfxs+ykd3DOQ84kj9tAFeD+kuQGqf02tumLiuKdjkOU4CDc+qIlW9rhms0tYFoWRbJUla9qnbo/FE7eZrjnNar3/mgab2yBTKFpEy7JPNvvkgLf6oPT/4+/NuZBrCRfZn6BUQBWtZ1Bg4b4G3YqVELTXWoC+6POjOL46dZrod4oIk9tYX+q1XrK04G6Ex8AxHgteMgYK+GQ+9P3/wEGH/ph0zNkOaj0gr9T0cnk7MmG+aXo3LCD5Rf8X/Xqh1D80RPdPMby96MMQ+JIQTGg69yxgKi46DBIBujuoGHtcm5HRPPbNCBWRiZL/+N5CtJokH1DCRTRdDV27HrdFOTJ3wTXm08r1aF/sMz1qXb2t+gFvxUHqSr544wsKAk3lmSSY=
  - secure: aDSyBy7RhsJvkLMD/zJdZ5Kzeun0B368lQmkOaSGvYPvQlC9TVDUCFiPqYevboYLlMJvZQVWMUNxKcrxKA9cbXHZRQ04DD3La/Xhs44aqIeTsfCggaoSNRMF+wWzHL8XxcRniiOQ8L7d/fnLw63hXS7I7Q+nk0WSX7GgJphlvgmtv/xSp5GLAggsAAeaLEpzeDTZTmy+eWS3i8T/7Qz/LmoYQqrcRlcMf3+FkQDQVyt7fljD3CA/Xq07aijDRgXgOc/gXICmltPvOCyv5NbH+2JPjrhc1jVsl4hQZmQZTrk/8ryy0HCxeKhLW3Y8LbD13RdWEBt90yHRD8w7vnj/whS2hhTn2WtGOlWG9LFcTMV5x9qz+YXDcp30gYTPVCWFmyfl/qjqD4c2ZtjcrHe01PLgQenhwaHI03Q4OSfHeprqBZIgi2UhVIlpvOivw2VubO3OGipkWezeNFcnlGQ4tS6k3Sm143A3FNYiCj8TnPkhEWOufFLoMtXWvEPlicIcNHoSSSNGVbJrCGTT5QmO/ujYs/hQtePPGaozNTYRHDs3yaoaXv9jpiOrJvnaWK6SbNhSkA5H4KqIJliPDli3G+UL8naBWqLNQ+FkKBxzsSe157WFyFUpGyLDIEMaLAg+Rl1vj0FY0qT6PBBAlLksc+u+uk5JYdAdRVaz99f1sZw=
  - PGENDPOINT=cpcwpd9wzcsiq1.cg5ybcpnkj4u.us-east-1.rds.amazonaws.com
  - PGUSERNAME=example
  - PGPASSWORD=serverless
  - npm_config_PGCON=postgresql://example:serverless@cpcwpd9wzcsiq1.cg5ybcpnkj4u.us-east-1.rds.amazonaws.com:5432/floods
  - npm_config_PGRUNCON=postgresql://floods_postgraphql:xyz@cpcwpd9wzcsiq1.cg5ybcpnkj4u.us-east-1.rds.amazonaws.com:5432/floods
  - POSTGRAPHQL_ENDPOINT=https://ttq0rbjwwl.execute-api.us-east-1.amazonaws.com/dev/graphql
  - CURRENT_FLOODS_BRANCH_NAME=persistent-db
  - FRONTEND_URL=localhost
  - GMAIL_ADDRESS=fake@email
